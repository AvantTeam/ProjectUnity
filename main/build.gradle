sourceSets.main.java.srcDirs = ["src/", "$buildDir/generated/sources/annotationProcessor/java/main/"]
sourceSets.main.resources.srcDirs = ["assets/"]

repositories{
    mavenCentral()
    maven{url "https://www.jitpack.io"}
}

ext{
    sdkRoot = System.getenv("ANDROID_HOME")
    sdkVersion = "30.0.1"

    doExec = {cmd ->
        def proc = cmd.execute(null, new File("$buildDir/libs"))
        proc.waitForProcessOutput(System.out, System.err)
    }
}

task dex{
    doLast{
        if(System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')){
            doExec("cmd /c dx --dex --keep-classes --min-sdk-version=30 --output=${modName}Android.jar ${modName}Desktop.jar")
        }else{
            doExec("dx --dex --keep-classes --min-sdk-version=30 --output=${modName}Android.jar ${modName}Desktop.jar")
        }
    }
}

jar{
    archiveFileName = "${modName}Desktop.jar"

    from{
        configurations.runtimeClasspath.collect{it.isDirectory() ? it : zipTree(it)}
    }
}

task deploy(dependsOn: [jar, dex])

dependencies{
    compileOnly "com.github.Anuken.Arc:arc-core:$mindustryVersion"
    compileOnly "com.github.Anuken.Mindustry:core:$mindustryVersion"

    implementation "com.github.younggam:multi-lib:$multilibVersion"
    annotationProcessor "com.github.Anuken:jabel:$jabelVersion"

    compileOnly project(":annotations")
    annotationProcessor project(":annotations")

    compileJava.options.compilerArgs.addAll([
        "-processor", "unity.annotations.FactionProcessor,unity.annotations.ExpProcessor,unity.annotations.EntityProcessor,unity.annotations.LoadProcessor"
    ])
}
